<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/css/stylesheet.css}">
    <title th:text="#{title}">Quiz App</title>
</head>
<body class="bg-secondary bg-gradient">
<div>
    <nav th:replace="~{fragments/navigation}"></nav>
</div>
<div class="text-light text-center mt-5 pb-5 border-bottom border-5 border-secondary-subtle rounded-bottom">
    <div class="header-background">
        <h1 class="quizHeader" th:text="#{title}"></h1>
    </div>
</div>
<div class="container mt-4 container text-center">
    <h2 class="mb-4 text-light" th:text="${quizDTO.name}">Available Quizzes</h2>
</div>

<div class="sticky-top bg-white text-secondary py-2 d-flex justify-content-between align-items-center px-4 border-bottom shadow-sm" style="z-index: 1100;">
    <div><h5 class="mb-0">‚è≥ Time remaining: <span id="timer" class="fw-bold">02:00</span></h5></div>
    <div class="progress" style="width: 50%; height: 20px;">
        <div id="progressBar" class="progress-bar bg-success" style="width: 0%;">0%</div>
    </div>
</div>
<form class="container mt-5" th:action="@{/quiz/submit}" method="post" th:object="${quizDTO}">
    <div class="row justify-content-center">
        <div class="col-md-8" th:each="question : ${quizDTO.questions}">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 th:text="${question.description}">Question text</h5>
                        <div th:each="entry : ${question.answers.entrySet()}">
                            <div class="form-check">
                                <input class="form-check-input answer-radio" type="radio"
                                    th:name="${question.id}"
                                    th:id="'q' + ${question.id} + '_' + ${entry.key.hashCode()}"
                                    th:value="${entry.key}">
                                <label class="form-check-label" th:for="'q' + ${question.id} + '_' + ${entry.key.hashCode()}"
                                    th:text="${entry.key}">Answer text</label>
                            </div>
                        </div>

                    </div>
                </div>
        </div>
    </div>
    <div class="text-center mt-4 mb-4">
        <button type="submit" class="btn btn-primary btn-lg px-5 py-2">
            Submit
        </button>
    </div>
</form>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const radios = document.querySelectorAll(".answer-radio");
        const totalQuestions = new Set([...radios].map(r => r.name)).size;
        const answered = new Set();
        const bar = document.getElementById("progressBar");

        radios.forEach(r => {
            r.addEventListener("change", () => {
                answered.add(r.name);
                const percent = Math.round((answered.size / totalQuestions) * 100);
                bar.style.width = percent + "%";
                bar.textContent = percent + "%";
            });
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const totalTime = 2 * 60;
        let timeLeft = totalTime;

        const timerDisplay = document.getElementById("timer");
        const form = document.querySelector("form");

        const timer = setInterval(() => {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            if (timeLeft <= 0) {
                clearInterval(timer);
                alert("Time is up! Submitting your answers...");
                form.submit();
            }

            timeLeft--;
        }, 1000);
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
